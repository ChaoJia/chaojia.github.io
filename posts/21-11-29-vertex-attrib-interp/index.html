<!doctype html><html lang=en data-figures class=page><head><title>Vertex Attribute Interpolation and Analytical Derivatives | Chao Jia</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=x-ua-compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","XXXXXXXXXX")</script><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta name=description content="vertex attribute interpolation and derivatives for visibility buffer rendering"><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta name=twitter:title content="Vertex Attribute Interpolation and Analytical Derivatives"><meta property="og:url" content="https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/"><meta property="og:title" content="Vertex Attribute Interpolation and Analytical Derivatives"><meta property="og:description" content="vertex attribute interpolation and derivatives for visibility buffer rendering"><meta property="og:image" content="https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/images/posts/2021-11-29/attr_interp_thumbnail.svg"><meta name=keywords content="vulkan,c++,computer graphics,gpu"><link rel=apple-touch-icon sizes=180x180 href=https://chaojia.github.io/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://chaojia.github.io/icons/favicon-32x32.png><link rel=manifest href=https://chaojia.github.io/icons/site.webmanifest><link rel=canonical href=https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/><link rel=preload href=https://chaojia.github.io/css/styles.332995b0fa245604db0805ba0e54d31227e0bdb86b58125bf45bb5d730e24d5adcfd38fc13beb121b50bebf35de7d2d84ed9767411baa0f85ab8dd9a9c12448a.css integrity="sha512-MymVsPokVgTbCAW6DlTTEifgvbhrWBJb9Fu11zDiTVrc/Tj8E76xIbUL6/Nd59LYTtl2dBG6oPhauN2anBJEig==" as=style crossorigin=anonymous><link rel=preload href=https://chaojia.github.io/en/js/bundle.4df33cb04cf6ec33c491fb22602851328fe94068514540411ad749a34090169761ab4488f35be638a17bda1da108cac8210481d645ffa89eafbc779b579cfb36.js as=script integrity="sha512-TfM8sEz27DPEkfsiYChRMo/pQGhRRUBBGtdJo0CQFpdhq0SI81vmOKF72h2hCMrIIQSB1kX/qJ6vvHebV5z7Ng==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://chaojia.github.io/css/styles.332995b0fa245604db0805ba0e54d31227e0bdb86b58125bf45bb5d730e24d5adcfd38fc13beb121b50bebf35de7d2d84ed9767411baa0f85ab8dd9a9c12448a.css integrity="sha512-MymVsPokVgTbCAW6DlTTEifgvbhrWBJb9Fu11zDiTVrc/Tj8E76xIbUL6/Nd59LYTtl2dBG6oPhauN2anBJEig==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity=sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity=sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script module>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body data-code=50 data-lines=true id=documentTop><header class=nav_header><nav class=nav><a href=https://chaojia.github.io/ class="nav_brand nav_item" title="Chao Jia"><img src=https://chaojia.github.io/images/logo-wide.svg class=logo alt="Chao Jia"><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg><svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_right'><div class=nav_parent><a href=https://chaojia.github.io/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://chaojia.github.io/portfolio/ class=nav_item title=Portfolio>Portfolio</a></div><div class=nav_parent><a href=https://chaojia.github.io/about/ class=nav_item title=About>About</a></div><div class=follow><a href=https://gitlab.com/chao-jia><svg class="icon"><title>gitlab</title><use xlink:href="#gitlab"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div><div class=nav_parent><a class=to-top-button href=#documentTop><img src=/icons/top-button.svg alt="to top"></a></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>Vertex Attribute Interpolation and Analytical Derivatives</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg></span><span class=post_date>29 Nov 2021</span>
<span><svg class="icon" viewBox="0 0 122.88 119.19"><defs><style>.cls-1{fill-rule:evenodd}</style></defs><path class="cls-1" d="M104.84 1.62 121.25 18a5.58 5.58.0 010 7.88L112.17 35l-24.3-24.3L97 1.62a5.6 5.6.0 017.88.0zM31.26 3.43h36.3L51.12 19.87H31.26A14.75 14.75.0 0020.8 24.2a14.75 14.75.0 00-4.33 10.46v68.07H84.5A14.78 14.78.0 0095 98.43a14.78 14.78.0 004.33-10.47V75.29l16.44-16.44V87.93A31.22 31.22.0 01106.59 110v.05a31.2 31.2.0 01-22 9.15h-72a12.5 12.5.0 01-8.83-3.67A12.51 12.51.0 010 106.65v-72a31.15 31.15.0 019.18-22l.05-.05a31.17 31.17.0 0122-9.16zM72.33 74.8 52.6 80.9c-13.85 3-13.73 6.15-11.16-6.91l6.64-23.44h0L83.27 15.31l24.3 24.3L72.35 74.83zM52.22 54.7l16 16-13 4c-10.15 3.13-10.1 5.22-7.34-4.55l4.34-15.4z"/></svg></span><span class=post_date>29 Jun 2022</span>
<span class=post_time>· 7 min read</span><span>&nbsp;· <a href=https://chaojia.github.io/tags/real-time-rendering title="real-time rendering" class="post_tag button button_translucent">real-time rendering
</a><a href=https://chaojia.github.io/tags/math title=math class="post_tag button button_translucent">math</a></span>
<span class=page_only>&nbsp;·<div class=post_share><a href="https://twitter.com/intent/tweet?text=Vertex%20Attribute%20Interpolation%20and%20Analytical%20Derivatives&url=https%3a%2f%2fchaojia.github.io%2fposts%2f21-11-29-vertex-attrib-interp%2f&tw_p=tweetbutton" class=twitter title=" Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg></a><a href=#linkedinshare id=linkedinshare class=linkedin title=" LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg></a><a href=https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_body><p>For visibility buffer rendering <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, we cannot rely on the hardware rasterization and built-in functions in fragment shader to do the vertex attribute interpolation and implicitly compute partial derivatives (i.e. <code>dFdx</code> and <code>dFdy</code> in <em>glsl</em>). This article describes the math behind a simple way to analytically compute these values, and provides formulas that can be easily translated to <a href=https://gitlab.com/chao-jia/spock/-/blob/edc9e132e47c6696f2cc08002368224536107bbd/assets/glsl/basic_test/lighting_utils.h.glsl#L332>shader code</a> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.
Although there are some existing implementations, they are <a href=#pitfalls-existing-implementations>not quite satisfactory</a>, which motivates me to do my own math.</p><p>In general, we want to interpolate attributes (e.g. uv or normal) in a space before the perspective transform (object space, world space or camera space), as this is where these attributes are usually created. Therefore, in order to calculate the attributes of a pixel, we need to find the barycentric coordinates of the point in a pre-perspective space that is projected to that pixel. Because transform between pre-perspective spaces are affine transformations which preserve barycentric coordinates, without loss of generality, we can assume object space, world space and camera space are identical, and simply start with camera space.</p><h2 id=notations>Notations</h2><p>First, some notations and conventions used throughout this article:</p><ul><li>index $i \in \lbrace 0, 1, 2 \rbrace$;</li><li>$\textcolor{darkgoldenrod}{i \oplus k = (i + k) \mod 3}$; (<strong>a bit unconventional</strong>)</li><li>$X^e, X^c, X^n$ represent $X$ in <em>camera (or eye) space</em>, <em>clip space</em> and <em>screen space (with NDC)</em> respectively;</li><li>NDC refers to <em>normalized device coordinates</em> in screen space (<a href=https://computergraphics.stackexchange.com/a/1771/7133>different coordinates</a>).</li></ul><h2 id=attribute-interpolation>Attribute interpolation</h2><p>Suppose there is a triangle $T^e$ (in camera space) with three vertices $V^e_i = (x^e_i, y^e_i, z^e_i, 1)$. After perspective projection by Matrix $\bm{P}$, $V^e_i$ is transformed to $V^c_i = (x^c_i, y^c_i, z^c_i, w_i) = \bm{P}\cdot V^e_i$ in clip space, and by applying perspective divide to $V^c_i$, we have the NDC $V^n_i = (x^n_i, y^n_i, z^n_i, 1) = V^c_i/w_i$ in screen space.</p><p>For a point $V^e = (x^e, y^e, z^e, 1)$ in triangle $T^e$ with the barycentric coordinates $\lambda^e_i$, namely $V^e = \sum \lambda^e_i V^e_i$, its coordinates in clip space: $V^c = (x^c, y^c, z^c, w) = \bm{P}\cdot V^e$, and NDC: $V^n = (x^n, y^n, z^n, 1) = V^c/w$. Assume the barycentric coordinates of $V^n$ in screen space are $\lambda^n_i$, that is, $V^n = \sum\lambda^n_iV^n_i$. Then we have
$$
\begin{align*}
V^n &= \sum\textcolor{orangered}{\lambda^n_i}V^n_i \\
&= \frac{V^c}{w} = \frac{\bm{P}\cdot V^e}{w} = \frac{\bm{P}\sum \lambda^e_iV^e_i}{w} \\
&= \sum\frac{\lambda^e_i}{w}(\bm{P}\cdot V^e_i) = \sum \frac{\lambda^e_i}{w}V^c_i \\
&= \sum\textcolor{orangered}{\frac{\lambda^e_i}{w}w_i}V^n_i
\end{align*}
$$</p><p>Since the barycentric coordinates of $V^n$ are unique, we have
$$
\begin{equation}
\lambda^e_i = \frac{w\lambda^n_i}{w_i}.
\end{equation}
$$
For a given pixel location, we can lookup the corresponding triangle data based on the triangle index stored in visibility buffer. It is straightforward to compute $w_i$ and $\lambda^n_i$ once the vertex positions are known alongside the transformation matrices and the resolution of the framebuffer. $\lambda^n_i$ can be computed as the ratio of the areas of 2D triangles (only $x$ and $y$ components of NDC are considered), which in turn are the determinants of the matrices formed by the 2D edge vectors of these 2D triangles:</p><p>$$
\begin{equation}
\lambda^n_i = \frac{1}{\mathcal{D}}\begin{vmatrix}
x^n_{i \oplus 1} - x^n & x^n_{i \oplus 2} - x^n \\
y^n_{i \oplus 1} - y^n & y^n_{i \oplus 2} - y^n
\end{vmatrix}
\end{equation}
$$</p><p>where $\mathcal{D}$ is <em>twice</em> the area of the 2D triangle $\triangle V^n_0 V^n_1 V^n_2$, and can be calculated as</p><p>$$
\begin{equation*}
\mathcal{D} = \begin{vmatrix}
x^n_1 - x^n_0 & x^n_2 - x^n_0 \\
y^n_1 - y^n_0 & y^n_2 - y^n_0
\end{vmatrix}
\end{equation*}
$$</p><figure class=center-figure><img src=/images/posts/2021-11-29/attr_interp_01.svg width=30%></figure><p>Due to the fact that <strong>$1/w$ is linear in screen space</strong> (see <a href=#proof-1-w-linear>a short proof</a> below), we have
$$
\begin{equation}
\frac{1}{w} = \sum\displaystyle\lambda^n_i\frac{1}{w_i}.
\end{equation}
$$</p><p>By now we have all the ingredients needed to compute $\lambda^e_i$. It is worth noting that generally $\lambda^e_i \neq \lambda^n_i$, hence the necessity for <a href=https://en.wikipedia.org/wiki/Texture_mapping#Perspective_correctness>perspective correction</a>. Let $A_i$ be an attribute of vertex $V^e_i$, for point $V^e$, the interpolated attribute is $A = \sum\lambda^e_i A_i$, thus
$$
\frac{A}{w} = \sum\frac{\lambda^e_i}{w}A_i \underbrace{=}_{\text{Eq. (1)}} \sum\frac{\lambda^n_i}{w_i}A_i.
$$</p><h2 id=derivatives>Derivatives</h2><p>Clearly $A_i$ and $w_i$ are constant, so they don't vary along $x^n$-axis or $y^n$-axis, therefore we have</p><p>$$
\begin{equation}
\frac{\partial(A/w)}{\partial x^n} = \sum\frac{A_i}{w_i}\frac{\partial \lambda^n_i}{\partial x^n}.
\end{equation}
$$</p><p>So the partial derivative</p><p>$$
\begin{align*}
\frac{\partial A}{\partial x^n}
&= \frac{\partial (w \frac{A}{w})}{\partial x^n} \\
&= \frac{\partial(\frac{1}{w})^{-1}}{\partial x^n}\frac{A}{w} + w\frac{\partial\frac{A}{w}}{\partial x^n} \\
&= -\sum\frac{wA}{w_i}\frac{\partial \lambda^n_i}{\partial x^n} + \sum\frac{wA_i}{w_i}\frac{\partial \lambda^n_i}{\partial x^n}\hspace{2em}\Longleftarrow \textit{Eq. (3) and Eq. (4)} \\
&= w\sum\left(\frac{A_i - A}{w_i}\frac{\partial \lambda^n_i}{\partial x^n}\right) \\
&= \begin{bmatrix}
\cdots & A_i - A & \cdots
\end{bmatrix}
\underbrace{\begin{bmatrix}
\vdots \\ \frac{w}{w_i}\frac{\partial \lambda^n_i}{\partial x^n} \\ \vdots
\end{bmatrix}}_{\bm{T}_x}.
\end{align*}
$$</p><p>Analogously, the partial derivative</p><p>$$
\frac{\partial A}{\partial y^n} =
\begin{bmatrix}
\cdots & A_i - A & \cdots
\end{bmatrix}
\underbrace{\begin{bmatrix}
\vdots \\ \frac{w}{w_i}\frac{\partial \lambda^n_i}{\partial y^n} \\ \vdots
\end{bmatrix}}_{\bm{T}_y}.
$$</p><p>Given Eq. (2), the last unknown pieces in $\bm{T}_x$ and $\bm{T}_y$ can be computed as</p><p>$$
\frac{\partial \lambda^n_i}{\partial x^n} = \frac{y^n_{i \oplus 1} - y^n_{i \oplus 2}}{\mathcal{D}},
$$
$$
\frac{\partial \lambda^n_i}{\partial y^n} = \frac{x^n_{i \oplus 2} - x^n_{i \oplus 1}}{\mathcal{D}}.
$$</p><p>An advantage of this approach is that once the matrices $\bm{T_x}$ and $\bm{T_y}$ in the above equation is calculated, it can be used to compute screen-space partial derivatives of any attributes. .</p><h2 id=result>Result</h2><figure style=text-align:center><div class=img-cmp-div data-width-ratio=1><div class=img-cmp-bg-div><img class=img-cmp-bg src=/images/posts/2021-11-29/render_hardware.png></div><div class=img-cmp-slider><div class=img-cmp-slider-button></div></div><div class=img-cmp-fg-div><img class=img-cmp-fg src=/images/posts/2021-11-29/render_analytical.png></div></div><figcaption>Left: analytical derivatives; Right: hardware derivatives</figcaption></figure><p>The image on the left is rendered with analytically calculated attributes and derivatives, which looks identical to the render using hardware-generated attributes and derivatives on the right. The subtle difference can be revealed by some statistics of per pixel difference (normalized):</p><table><thead><tr><th style=text-align:center>Average</th><th style=text-align:center>Median</th><th style=text-align:center>Maximum</th></tr></thead><tbody><tr><td style=text-align:center>0.000050</td><td style=text-align:center>0.000000</td><td style=text-align:center>0.054902</td></tr></tbody></table><figure class=center-figure><img src=/images/posts/2021-11-29/duv_diff.png width=100%></figure><p>The color in the image above shows the difference between analytically computed and hardware-generated derivatives of uv coordinates. The difference is calculated as $\Vert\frac{\partial(UV)}{\partial x^n} - \texttt{dFdx(UV)}\Vert + \Vert\frac{\partial(UV)}{\partial y^n} - \texttt{dFdy(UV)}\Vert$ , with hardware-generated derivatives in $\texttt{monospaced font}$. Other than a few sparse bright spots, the image is mostly black, meaning that the difference is mostly negligible, and the analytical derivatives are indeed very accurate and precise.</p><h2 id=pitfalls-existing-implementations>Pitfalls of some existing implementations</h2><p>The accompanying code of the original paper on visibility buffer rendering <sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> computed screen-space derivatives of uv coordinates by also computing the uv coordinates of the upper and right neighboring pixels. It tends to get more computationally intensive if we have more attributes apart from uv coordinates, such as world positions and normals.</p><p>The DAIS paper <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> only provided Eq. (4) $\frac{\partial (\lambda^n / w)}{\partial x^n}$ regarding attribute derivatives in its appendix, and the shader code for computing derivatives given in its extended version <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> does not seem to take $\frac{\partial w}{\partial x^n}$ into consideration either. In my experiment, the texture LOD inferred from derivatives calculated this way is incorrect, especially for large triangles in screen space, the render becomes blurry.</p><p>In rendering framework <em>The Forge</em> <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, the derivatives are calculated in a similar fashion to the DAIS paper, but with some obscure tweaks added which do not seem mathematically sound to me.</p><h2 id=proof-1-w-linear>Proof of $1/w$ being linear in screen space</h2><p>Same as above, $\bm{P}$ represents the perspective projection matrix <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>, and we have
$$\bm{P}\cdot V^e =
\begin{bmatrix}
\cdot & \cdot & \cdot & \cdot \\
\cdot & \cdot & \cdot & \cdot \\
0 & 0 & \alpha & \beta \\
0 & 0 & \gamma & 0
\end{bmatrix}
\begin{bmatrix}
x^e \\
y^e \\
z^e \\
1
\end{bmatrix} =
\begin{bmatrix}
x^c \\
y^c \\
z^c \\
w
\end{bmatrix} = w
\begin{bmatrix}
x^n \\
y^n \\
z^n \\
1
\end{bmatrix}
.
$$
After some algebraic manipulation we have
$$
z^n = \frac{z^c}{w} = \frac{\alpha z^e + \beta}{w} = \frac{\alpha (w/\gamma) + \beta}{w} = \frac{\alpha}{\gamma} + \beta\textcolor{orangered}{\frac{1}{w}}.
$$
On the other hand,
$$
\begin{aligned}
z^n &= \sum\lambda^n_i z^n_i \\
&= \sum\lambda^n_i \left(\frac{\alpha}{\gamma} + \beta\frac{1}{w_i}\right) \\
&= (\frac{\alpha}{\gamma}\sum\lambda^n_i) + \beta\sum\lambda^n_i\frac{1}{w_i} \\
&= \frac{\alpha}{\gamma} + \beta\textcolor{orangered}{\sum\lambda^n_i\frac{1}{w_i}}.\hspace{2em}\Longleftarrow \sum\lambda^n_i = 1
\end{aligned}
$$
Therefore
$$
\frac{1}{w} = \sum\lambda^n_i\frac{1}{w_i},
$$
which implies that $\frac{1}{w}$ is linear in screen space.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Christopher A. Burns and Warren A. Hunt, <em><a href=https://jcgt.org/published/0002/02/04/>The Visibility Buffer: A Cache-Friendly Approach to Deferred Shading</a></em>, Journal of Computer Graphics Techniques (JCGT), vol. 2, no. 2, 55-69, 2013&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=http://filmicworlds.com/blog/visibility-buffer-rendering-with-material-graphs/>Visibility Buffer Rendering with Material Graphs</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>My first glsl implementation that roughly followed this article can be found <a href=https://gitlab.com/chao-jia/spock/-/blob/edc9e132e47c6696f2cc08002368224536107bbd/assets/glsl/basic_test/lighting_utils.h.glsl#L332>here</a>; the derivation and the glsl implementation was already done by 29th Nov 2021, but I only had the time a few months later to get the write-up done, and made some improvement to the glsl code. Hopefully the <a href=https://gitlab.com/chao-jia/spock/-/blob/21e4d17588fe05bf3edc2620f3478107f4d53342/etc/glsl/basic_renderer/miscellaneous.hsl#L389>refined code</a> is more readable&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Christoph Schied and Carsten Dachsbacher. 2015. <em><a href=https://cg.ivd.kit.edu/publications/2015/dais/DAIS.pdf>Deferred attribute interpolation for memory-efficient deferred shading</a></em>. In Proceedings of the 7th Conference on High-Performance Graphics (HPG '15). Association for Computing Machinery, New York, NY, USA, 43-49. <a href=https://doi.org/10.1145/2790060.2790066>https://doi.org/10.1145/2790060.2790066</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Part II Chapter 3, Listing 3.2 of the book <em>GPU Pro 7: Advanced Rendering Techniques (1st ed.)</em> by Engel, W. (Ed.). (2016). A K Peters/CRC Press. <a href=https://doi.org/10.1201/b21261>https://doi.org/10.1201/b21261</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><em><a href=https://github.com/ConfettiFX/The-Forge/blob/v1.50/Examples_3/Visibility_Buffer/src/Shaders/FSL/visibilityBuffer_shade.frag.fsl>Attribute derivatives in rendering framework The Forge</a></em>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><em>Real Time Rendering, 4th Edition</em>: $\S$ 4.7.2 Perspective Projection&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><em><a href=https://vincent-p.github.io/posts/vulkan_perspective_matrix/>The perspective projection matrix in Vulkan</a></em>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post_comments><script type=module>

const light = 'lit';
const dark = 'dim';
const storageKey = 'colorMode';
const key = '--color-mode';
const data = 'data-mode';
const bank = window.localStorage;

function currentMode() {
  let acceptableChars = light + dark;
  acceptableChars = [...acceptableChars];
  let mode = getComputedStyle(doc).getPropertyValue(key).replace(/\"/g, '').trim();

  mode = [...mode].filter(function(letter){
    return acceptableChars.includes(letter);
  });

  return mode.join('');
}

function appendUtterances() {
  let initialTheme = currentMode() == dark ? 'github-dark' : 'github-light';
  const s = document.createElement('script');
  s.src = 'https://utteranc.es/client.js';
  s.setAttribute('repo', 'ChaoJia\/chaojia.github.io');
  s.setAttribute('issue-term', 'pathname');
  s.setAttribute('theme', initialTheme);
  s.setAttribute('crossorigin', 'anonymous');
  s.setAttribute('async', '');
  const commentsContainer = document.getElementsByClassName('post_comments')[0];
  commentsContainer.appendChild(s);
}

appendUtterances();

</script></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=Search... id=find autocomplete=off data-scope=posts>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><h2>Chao Jia</h2><div class=author_bio>C++, Computer Graphics</div><a href=https://chaojia.github.io/about/ class="button mt-1" role=button title='Read More'>Read More</a><h2 class=mt-4>Recent Posts</h2><ul class=flex-column><li><a href=https://chaojia.github.io/posts/22-08-22-vulkan-basic-renderer/ class=nav-link title="A Basic Vulkan Renderer">A Basic Vulkan Renderer</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>Categories</h2><nav class=tags_nav><a href=https://chaojia.github.io/categories/graphics/ class="post_tag button button_translucent" title=graphics>GRAPHICS
<span class=button_tally>2</span></a>
<a href=https://chaojia.github.io/categories/rendering/ class="post_tag button button_translucent" title=rendering>RENDERING
<span class=button_tally>2</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>Tags</h2><nav class=tags_nav><a href=https://chaojia.github.io/tags/real-time-rendering/ class="post_tag button button_translucent" title=real-time-rendering>REAL-TIME-RENDERING
<span class=button_tally>2</span></a>
<a href=https://chaojia.github.io/tags/c++/ class="post_tag button button_translucent" title=c++>C++
<span class=button_tally>1</span></a>
<a href=https://chaojia.github.io/tags/math/ class="post_tag button button_translucent" title=math>MATH
<span class=button_tally>1</span></a>
<a href=https://chaojia.github.io/tags/rtx/ class="post_tag button button_translucent" title=rtx>RTX
<span class=button_tally>1</span></a>
<a href=https://chaojia.github.io/tags/vulkan/ class="post_tag button button_translucent" title=vulkan>VULKAN
<span class=button_tally>1</span></a></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://chaojia.github.io/images/logo.svg class="icon icon_2 transparent" alt="Chao Jia"><p>Copyright&nbsp;<span class=year></span>&nbsp;CHAO JIA. All Rights Reserved</p></div></footer><script type=text/javascript src=https://chaojia.github.io/en/js/bundle.4df33cb04cf6ec33c491fb22602851328fe94068514540411ad749a34090169761ab4488f35be638a17bda1da108cac8210481d645ffa89eafbc779b579cfb36.js integrity="sha512-TfM8sEz27DPEkfsiYChRMo/pQGhRRUBBGtdJo0CQFpdhq0SI81vmOKF72h2hCMrIIQSB1kX/qJ6vvHebV5z7Ng==" crossorigin=anonymous></script>
<script src=https://chaojia.github.io/js/search.min.0e719949d04151f856e853d943aedc4042f7a0e5c3818c5f22ecc12d61099a68ef736ae00ea821815823ea0197e81ccb2dac7168f4baf6cfc83d6cc3c39e4b13.js></script></body></html>