<!doctype html><html lang=en data-figures class=page><head><title>A Basic Vulkan Renderer | Chao Jia</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","XXXXXXXXXX")</script><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta name=description content="an introduction to my basic Vulkan renderer"><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta name=twitter:title content="A Basic Vulkan Renderer"><meta name=twitter:image content="https://chaojia.github.io/images/posts/2022-08-22/basic-vulkan-renderer-thumbnail.jpg"><meta property="og:url" content="https://chaojia.github.io/posts/22-08-22-vulkan-basic-renderer/"><meta property="og:title" content="A Basic Vulkan Renderer"><meta property="og:description" content="an introduction to my basic Vulkan renderer"><meta property="og:image" content="https://chaojia.github.io/images/posts/2022-08-22/basic-vulkan-renderer-thumbnail.jpg"><meta name=keywords content="vulkan,c++,computer graphics,gpu,real-time rendering,vulkan,RTX,C++"><link rel=apple-touch-icon sizes=180x180 href=https://chaojia.github.io/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://chaojia.github.io/icons/favicon-32x32.png><link rel=manifest href=https://chaojia.github.io/icons/site.webmanifest><link rel=canonical href=https://chaojia.github.io/posts/22-08-22-vulkan-basic-renderer/><link rel=preload href=https://chaojia.github.io/css/styles.efcd92f94e3298341eb4d755e6b9434d52e44f2a094221a70106f6c6f0ad05ade861e339537918e2aa93a541294716050897d52a61d46fa549b9d774deda6274.css integrity="sha512-782S+U4ymDQetNdV5rlDTVLkTyoJQiGnAQb2xvCtBa3oYeM5U3kY4qqTpUEpRxYFCJfVKmHUb6VJudd03tpidA==" as=style crossorigin=anonymous><link rel=preload href=https://chaojia.github.io/en/js/bundle.530b93f8d0aee3448bb6eb26a4511f74ffd5c79691ceb46e604efd83030618d58068f616ae32d64309c8c7fb8de76c58f297b69ba0795ff63e9ab0fa866816a0.js as=script integrity="sha512-UwuT+NCu40SLtusmpFEfdP/Vx5aRzrRuYE79gwMGGNWAaPYWrjLWQwnIx/uN52xY8pe2m6B5X/Y+mrD6hmgWoA==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://chaojia.github.io/css/styles.efcd92f94e3298341eb4d755e6b9434d52e44f2a094221a70106f6c6f0ad05ade861e339537918e2aa93a541294716050897d52a61d46fa549b9d774deda6274.css integrity="sha512-782S+U4ymDQetNdV5rlDTVLkTyoJQiGnAQb2xvCtBa3oYeM5U3kY4qqTpUEpRxYFCJfVKmHUb6VJudd03tpidA==" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity=sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity=sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script module>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></head><body data-code=50 data-lines=true id=documentTop data-lang=en><header class=nav_header><nav class=nav><a href=https://chaojia.github.io/ class="nav_brand nav_item" title="Chao Jia"><img src=https://chaojia.github.io/images/logo-wide.svg class=logo alt="Chao Jia"><div class=nav_close><div><svg class="icon"><title>open-menu</title><use xlink:href="#open-menu"/></svg>
<svg class="icon"><title>closeme</title><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_right'><div class=nav_parent><a href=https://chaojia.github.io/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://chaojia.github.io/portfolio/ class=nav_item title=Portfolio>Portfolio</a></div><div class=nav_parent><a href=https://chaojia.github.io/about/ class=nav_item title=About>About</a></div><div class=follow><a href=https://gitlab.com/chao-jia><svg class="icon"><title>gitlab</title><use xlink:href="#gitlab"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div><div class=nav_parent><a class=to-top-button href=#documentTop><img src=/icons/top-button.svg alt="to top"></a></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>A Basic Vulkan Renderer</h1><div class=post_meta><span><svg class="icon"><title>calendar</title><use xlink:href="#calendar"/></svg>
</span><span class=post_date>22 Aug 2022</span>
<span class=post_time>· 12 min read</span><span>&nbsp;· <a href=https://chaojia.github.io/tags/real-time-rendering title="real-time rendering" class="post_tag button button_translucent">real-time rendering
</a><a href=https://chaojia.github.io/tags/vulkan title=vulkan class="post_tag button button_translucent">vulkan
</a><a href=https://chaojia.github.io/tags/rtx title=RTX class="post_tag button button_translucent">RTX
</a><a href=https://chaojia.github.io/tags/c++ title=C++ class="post_tag button button_translucent">C++
</a></span><span class=page_only>&nbsp;·<div class=post_share><a href="https://twitter.com/intent/tweet?text=A%20Basic%20Vulkan%20Renderer&url=https%3a%2f%2fchaojia.github.io%2fposts%2f22-08-22-vulkan-basic-renderer%2f&tw_p=tweetbutton" class=twitter title=" Twitter" target=_blank rel=nofollow><svg class="icon"><title>twitter</title><use xlink:href="#twitter"/></svg>
</a><a href=#linkedinshare id=linkedinshare class=linkedin title=" LinkedIn" rel=nofollow><svg class="icon"><title>linkedin</title><use xlink:href="#linkedin"/></svg>
</a><a href=https://chaojia.github.io/posts/22-08-22-vulkan-basic-renderer/ title="Copy Link" class="link link_yank"><svg class="icon"><title>copy</title><use xlink:href="#copy"/></svg></a></div></span></div><div class=post_body><p>As part of the effort to get myself familiar with Vulkan, I developed a real-time renderer featuring global illumination with RTX technique <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Aside from Dynamic Diffuse Global Illumination (DDGI) <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, ray-traced soft shadow and specular reflections with spatio-temporal denoising (SVGF <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>), I've also tried out some other interesting ideas.</p><h2 id=visibility-buffer-rendering-and-scene-management>Visibility buffer rendering and scene management</h2><p>Visibility buffer rendering <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> has gained its popularity as triangle meshes used in real-time applications are getting much finer details thanks to the rapidly increasing memory capacity and computational power of the GPU <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>. More details for triangle meshes generally means fewer pixels each triangle can cover. Due to low quad utilization <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, traditional deferred shading tends to get very inefficient since there is usually a lot of computation going on in the fragment shader to fill the G-buffer.</p><p>Since there doesn't seem to be any solid reasons against it, I decided to go with visibility buffer rendering, i.e., a simple G-buffer consisting of only triangle indices and depth values. One problem needs to be addressed is how to recover the geometric data required for shading from a triangle index, including world position, normal, uv coordinates at each pixel. Moreover, We need the derivatives of uv coordinates to determine the LOD of the textures. The derivatives of the world position may be useful for e.g. <a href=http://www.thetenthplanet.de/archives/1180>constructing cotangent frame</a>. To get the computation of partial derivatives right, I did some math and detailed the method for analytically computing partial derivatives in <a href=https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/>my last post</a>. Another piece of information needed for shading is material data, such as textures and alpha cutoff value (for e.g. tree leaves). To simplify scene management and avoid frequently updating descriptor sets, I took a bindless approach <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>. Although many mobile devices and integrated cards are not very friendly to this approach due to lack of support for Vulkan feature <code>shaderSampledImageArrayNonUniformIndexing</code> or <code>VK_EXT_descriptor_indexing</code>, or the supported limits such as <code>maxPerStageDescriptorSampledImages</code> are too small for typical test scenes like Sponza, GPUs that support RTX are usually very generous in this regard.</p><p>Partly due to a variety of different 3D formats, scene management can get quite complicated. Although I've dealt with <code>.ply</code> and <code>.obj</code> files while working on <a href=https://gitlab.com/chao-jia/pbd>my master project</a>, neither of them can really fulfill the requirement of a renderer by today's standard, at least in terms of materials that support Physically-Based Rendering (PBR). Therefore, this renderer only supports <a href=https://www.khronos.org/gltf/>glTF</a> format as it is royalty-free, extensible and has support for basic PBR materials among other advantages. Many other formats can be easily converted to glTF using <a href=https://www.blender.org/>blender</a>. Despite the fact that glTF can store most of its data in binary form, loading glTF models that contain many textures can still be very slow because decoding common image formats (e.g. <code>.jpg</code> or <code>.png</code>) is rather computationally expensive, but directly storing the decoded image data in a cache file is not ideal either due to storage constraints. Inspired by <a href=https://momentsingraphics.de/ToyRenderer2SceneManagement.html>this article</a>, I also opted for <a href=https://docs.microsoft.com/en-us/windows/win32/direct3d10/d3d10-graphics-programming-guide-resources-block-compression>block compression</a> to reduce the cache file size while accelerating scene loading. To facilitate batch upload of textures to the device (GPU), I packed all the textures alongside other scene data into a single binary cache file.</p><p>Putting everything together, I came up with the following binary format for the scene cache file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// metadata to determine if the cache is up-to-date
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>// punctual lights
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>// aabb lower and upper
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span><span class=nl>vertex_offsets</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nl>index_offsets</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nl>mtl_param_emissive_idx_offsets</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nl>mtl_param_alpha_cutoff_offsets</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nl>emissive_texture_count</span> <span class=p>:</span> <span class=kt>uint32_t</span> <span class=c1>// at least one black texture
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span><span class=nl>texture_strides</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span><span class=p>]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nl>texture_offsets</span> <span class=p>:</span> <span class=kt>uint32_t</span><span class=p>[</span><span class=n>material_type_count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=c1>// texture index offset for each mtl_type
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span><span class=n>position_buffer</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>normal_buffer</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=n>uv_buffer</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=n>index_buffer</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=n>triangle_mtl_idx_buffer</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=n>mtl_param_buffer</span><span class=p>;</span> <span class=c1>// array of scene_t::mtl_param_type[]
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span><span class=nl>sampler_count</span><span class=p>:</span> <span class=kt>uint16_t</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=n>sampler_infos</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=n>texture_descriptor_array</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1>// metadata to verify data integrity
</span></span></span></code></pre></div><p>The mesh data and material data are sorted by material types. Generally different material types need different rendering pipelines. For example, <code>MTL_TYPE_PRIMARY</code> corresponds to the metallic-roughness material with <code>alphaMode</code> set to the default value <code>OPAQUE</code>, while <code>MTL_TYPE_ALPHA_CUTOFF</code> differs only by setting <code>alphaMode</code> to <code>MASK</code>. An instance of a material type refers to a specific set of textures and material parameters.
<code>{ vertex | index | mtl_param* | texture }_offsets</code> are offsets of different material types in <code>*_buffer</code> or <code>texture_descriptor_array</code>. All <code>*Factor</code> fields in the glTF materials are either converted to <code>1x1</code> textures or multiplied into the corresponding texture.
Occlusion, metallic and roughness factors are merged into one texture as different color channels. Since emissive textures are relatively uncommon, a <code>1x1</code> black image shared by non-emissive material instances is put at the beginning of <code>texture_descriptor_array</code>, followed by other emissive textures. <code>vkCmdBlitImage</code>, C++ <code>std::thread</code> and parallel version of C++ standard algorithms library are used for faster generation of the cache data.</p><p>The cache file can greatly reduce the scene loading time. Here is the time it takes to load the scene <em>Amazon Lumberyard Bistro (exterior)</em> (glTF + textures: 898 MB; cache file: 1.05 GB) from a SSD:</p><table><thead><tr><th style=text-align:center>glTF 1st load</th><th style=text-align:center>glTF 2nd load</th><th style=text-align:center>cache 1st load</th><th style=text-align:center>cache 2nd load</th><th style=text-align:center>cache generation</th></tr></thead><tbody><tr><td style=text-align:center>35.554 s</td><td style=text-align:center>21.874 s</td><td style=text-align:center>2.239 s</td><td style=text-align:center>1.334 s</td><td style=text-align:center>23.468 s</td></tr></tbody></table><p>The operating system (Windows) probably caches those files in RAM after the 1st load, hence the 2nd load is faster than the 1st load. The difference can be much larger for HDD. Indeed, loading the cache from my HDD for the first time can take 10 seconds, but subsequent loading only takes about 2 seconds.</p><p>During the development of scene management, I noticed something interesting about the performance of <code>std::vector</code>. To avoid surprising behavior, <code>std::vector</code> (with default allocator) forces initialization on allocation, with either default zero-initialization or user provided value. Although this is the expected behavior for many use cases, it can unnecessarily hurt performance if the requested amount of memory is huge and the entire purpose of the allocation is to fill it with fixed amount of data. <code>std::array</code> can be used if the size is <em>known at compile time</em> and reasonably <em>small</em>. Otherwise plain array managed by <code>std::unique_ptr</code> is a better option:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln>1</span><span class=cl><span class=k>const</span> <span class=kt>uint32_t</span> <span class=n>num_f32_texels</span> <span class=o>=</span> <span class=mi>5592405</span><span class=p>;</span> <span class=c1>// texture: 2048 x 2048 x rgb, with full mipmap chain
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>glm</span><span class=o>::</span><span class=n>vec3</span><span class=o>&gt;</span> <span class=n>f32_texels</span><span class=p>(</span><span class=n>num_f32_texels</span><span class=p>,</span> <span class=n>glm</span><span class=o>::</span><span class=n>vec3</span><span class=p>{});</span> <span class=c1>// took 15.401600 ms
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>glm</span><span class=o>::</span><span class=n>vec3</span><span class=o>&gt;</span> <span class=n>f32_texels</span><span class=p>(</span><span class=n>num_f32_texels</span><span class=p>);</span> <span class=c1>// took 9.379000 ms
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>glm</span><span class=o>::</span><span class=n>vec3</span><span class=p>[]</span><span class=o>&gt;</span> <span class=n>f32_texels</span><span class=p>(</span><span class=k>new</span> <span class=n>glm</span><span class=o>::</span><span class=n>vec3</span><span class=p>[</span><span class=n>num_f32_texels</span><span class=p>]);</span> <span class=c1>// took 0.014100 ms
</span></span></span></code></pre></div><p>Another caveat came to my notice is the <code>propertyFlags</code> of Vulkan memory. One common operation is to copy a chunk of data from host to device, therefore device memory is often allocated with the flag <code>HOST_COHERENT</code>. However, to copy data from device to host, <code>HOST_CACHED</code> needs to be specified instead of <code>HOST_COHERENT</code>. It can make a huge difference. On my laptop (RTX 2070 Mobile), it takes <em>61.931</em> ms to copy 21 MB from a <code>HOST_VISIBLE</code>, optionally <code>HOST_COHERENT</code> buffer to the host memory, but only <em>3.839</em> ms if the buffer is <code>HOST_CACHED</code>.</p><h2 id=dynamic-diffuse-global-illumination-ddgi>Dynamic diffuse global illumination (DDGI)</h2><p>The implementation of DDGI is fairly straightforward, given the comprehensive description in the original papers <sup id=fnref1:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup> <sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup> and some optimization techniques explained <a href=https://diharaw.github.io/post/adventures_in_hybrid_rendering/#global-illumination>in this article</a>. One slightly irritating thing is the additional step (<code>VkDispatch</code>) for simply copying the border texels after updating the irradiance textures, because synchronization is needed right before copying the border texels. One trick I've tried out is to treat the vertices of the grid for each probe as the value stored in the textures of the irradiance field. That means we need a $7 \times 7$ texture for a probe resolution of $8 \times 8$, which is slightly lower than it would haven been, but the result differs not very much. There were no obvious artifacts on the radiance probes either. Nevertheless, I decided to copy the border texels at some point. To avoid the additional kernel launch, I figured out another trick after some observation. With the help of <a href=https://www.shadertoy.com/view/NsfBWf>the shader</a> I wrote on shadertoy to visualize the octahedral mapping, the pattern of the copy operations finally became clear to me.</p><figure class=center-figure><a href=https://www.shadertoy.com/view/NsfBWf><img src=/images/posts/2022-08-22/octahedral-mapping.jpg alt="visualization of octahedral mapping" width=50%></a><figcaption><p>visualization of octahedral mapping</p></figcaption></figure><p>Without loss of generality, let's assume the resolution of the original probe texture is $8 \times 8$ (square with four yellow filled texels $\colorbox{#f0f010}{\textcolor{#a0a0a0}{\textsf{A}}}, \colorbox{#f0f010}{\textcolor{#a0a0a0}{\textsf{B}}}, \colorbox{#f0f010}{\textcolor{#a0a0a0}{\textsf{C}}}, \colorbox{#f0f010}{\textcolor{#a0a0a0}{\textsf{D}}}$ as its four corners in the following image), the coordinates of texel $\colorbox{#f0f010}{\textcolor{#a0a0a0}{\textsf{A}}}$ is $(0, 0)$ and $+y$ axis goes downwards, then the resolution of the padded probe texture is $10 \times 10$ with the coordinates of its top left texel being $(-1, -1)$. For texels filled with greenish or reddish color (henceforth referred to as <em>type 1</em> texels), the source texel and destination texel of each copy operation need to be filled with exactly the same color.
Obviously every such texel in the original probe texture is only copied once, either vertically or horizontally. It is a bit more complicated for the yellow filled texels (henceforth referred to as <em>type 2</em> texels), as each of them is copied three times: vertically, horizontally and diagonally.</p><figure class=center-figure><img src=/images/posts/2022-08-22/ddgi-copy-border-texel.svg width=40%></figure><p>Some notations:</p><ul><li>$r$: the resolution of the original probe texture. In the image above, $r = 8$;</li><li>$n$: maximum value of the $x-$ or $y-$coordinate of the texels in the original probe texture, clearly $n = r -1$;</li><li>$i$: denotes $x-$ or $y-$coordinate of a texel in the original probe texture;</li><li><a href=https://en.wikipedia.org/wiki/Iverson_bracket>Iverson bracket</a> $[\dots]$ is used in the following definitions;</li><li>$q_i := [ i = n]$;</li><li>$m_i := [i = q_i \cdot n]$;</li><li>$g_i := i + 2q_i - 1$;</li><li>$h_i := n - i$;</li><li>$f_i := m_i \cdot g_i + (1 - m_i) \cdot h_i$;</li><li>$d_i := r \cdot (1 - q_i) - q_i$;</li></ul><p>It may seem unobvious, but the type of the texel with coordinates $(x, y)$ is $m_x + m_y$.
Besides, $m_i = 1$ means coordinate $i$ is mapped to $g_i$ (shifted by $\pm 1$ along the corresponding axis) and $m_i = 0$ means $i$ is mapped to $h_i$ (reflected along the corresponding axis). $f_i$ is the combined result.
<em>Type 1</em> texel $(x, y)$ is uniquely mapped to $(f_x, f_y)$.
<em>Type 2</em> texel $(x, y)$ is vertically mapped to $(g_x, h_y)$, horizontally mapped to $(h_x, g_y)$, and diagonally mapped to $(d_x, d_y)$.</p><p>With these simple functions, border texels can be copied in the same pass that updates the original probe texture, as in <a href=https://gitlab.com/chao-jia/spock/-/blob/21e4d17588fe05bf3edc2620f3478107f4d53342/etc/glsl/basic_renderer/ddgi/update_irradiance.comp#L134>my implementation</a>. Although a branch is introduced, this trick can spare us a memory barrier and another kernel launch. Since the updated probe texels still reside in registers (if no register spilling), it can help avoid some expensive global memory loads (if uncached) when copying border texels.</p><h2 id=spatio-temporal-denoising>Spatio-temporal denoising</h2><p>In this renderer, the noise comes from soft shadow and glossy reflection because of the low sampling rate (1 spp per frame for each). The (pseudo-)random numbers used for sampling are drawn from 4 blue noise textures downloaded from <a href=https://momentsingraphics.de/BlueNoise.html>here</a>. Sampling for soft shadow boils down to uniform sampling on a disk, which is fairly simple and well explained in <a href=https://blog.demofox.org/2020/05/16/using-blue-noise-for-raytraced-soft-shadows/>this article</a>. Sampling the direction of reflection for glossy materials, or equivalently sampling the normal distribution function, on the other hand, is not trivial. The implementation of the GGX VNDF Sampling <sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup> did the trick.</p><p>One issue with ray-traced shadow is the terminator problem caused by the fact that the smoothness of the geometry is merely approximated by the triangle meshes. If the origins of the shadow ray reside in the underlying triangles, we will inevitably get artifacts because the geometry those triangle meshes are trying to approximate is usually not flat. To work around this issue, I offset the shadow ray origins based on the vertex normals of the triangles, as explained in the article <em>Hacking the Shadow Terminator</em> <sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>. The resulting shadow is much more natural when shadow ray origin offset is applied, as shown in the following image.</p><figure style=text-align:center><div class=img-cmp-div data-width-ratio=1><div class=img-cmp-bg-div><img class=img-cmp-bg src=/images/posts/2022-08-22/shadow_2_without_offset_shading_point.png></div><div class=img-cmp-slider><div class=img-cmp-slider-button></div></div><div class=img-cmp-fg-div><img class=img-cmp-fg src=/images/posts/2022-08-22/shadow_1_offset_shading_point.png></div></div><figcaption>Left: with shadow ray origin offset; Right: without shadow ray offset</figcaption></figure><p>For shadow denoising, I closely followed SVGF <sup id=fnref1:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>, which introduced a manually tunable parameter $\alpha$ to control the temporal accumulation rate. It can be seen from <a href="https://youtu.be/Ca6BCejFWLw?t=142">this video</a> that the temporal accumulation plays an important role in the quality of the denoising. Therefore I was a bit skeptical while implementing temporal filtering technique in ReBLUR <sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup> for reflections because the accumulation rate is automatically adjusted. But the result turned out to be pretty satisfying. The rest of the denoising part for reflection still followed SVGF since it is already implemented in shadow denoising and I was quite confident about it.</p><h2 id=in-retrospect>In retrospect</h2><p>Despite the renderer can run in real-time ($70+$ fps for the Sponza scene on RTX 2070 mobile), the denoising part is not optimized as it was done in haste. For example, tile-based denoising could have been used because a large portion of shadow does not need to be denoised.</p><p>DDGI is not entirely flawless either. Light/shadow leak can still happen if some probes are in suboptimal position. Besides, the hysteresis parameter that controls the pace of temporal integration cannot be set too small to avoid unstable behavior, but the lag becomes noticeable when it is very large. Next time I may try to implement something like <a href="https://www.youtube.com/watch?v=2GYXuM10riw">Lumen in Unreal Engine 5</a>.</p><p>Other interesting topics such as animation support in scene management, temporal anti-aliasing (TAA) and polygonal light should definitely be on my todo list as well.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://gitlab.com/chao-jia/spock#the-basic-renderer>Source code</a> on GitLab and <a href=https://youtu.be/Ca6BCejFWLw>video</a> on YouTube&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Zander Majercik, Jean-Philippe Guertin, Derek Nowrouzezahrai, and Morgan McGuire, <a href=https://jcgt.org/published/0008/02/01/>Dynamic Diffuse Global Illumination with Ray-Traced Irradiance Fields</a>, Journal of Computer Graphics Techniques (JCGT), vol. 8, no. 2, 1-30, 2019&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Schied, Christoph, et al. <a href=https://dl.acm.org/doi/10.1145/3105762.3105770>Spatiotemporal variance-guided filtering: real-time reconstruction for path-traced global illumination.</a> Proceedings of High Performance Graphics. 2017. 1-12.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Christopher A. Burns and Warren A. Hunt, <a href=https://jcgt.org/published/0002/02/04/>The Visibility Buffer: A Cache-Friendly Approach to Deferred Shading</a>, Journal of Computer Graphics Techniques (JCGT), vol. 2, no. 2, 55-69, 2013&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://advances.realtimerendering.com/s2021/Karis_Nanite_SIGGRAPH_Advances_2021_final.pdf>Nanite - A Deep Dive</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>This article <a href=http://filmicworlds.com/blog/visibility-buffer-rendering-with-material-graphs/>Visibility Buffer Rendering with Material Graphs</a> provided thorough analysis and comprehensive performance test on forward shading, deferred shading and visibility buffer rendering&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>See the section <em>Bindless descriptor designs</em> of <a href=https://zeux.io/2020/02/27/writing-an-efficient-vulkan-renderer/>this article</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>Zander Majercik, Adam Marrs, Josef Spjut, and Morgan McGuire, <a href=https://jcgt.org/published/0010/02/01/>Scaling Probe-Based Real-Time Dynamic Global Illumination for Production</a>, Journal of Computer Graphics Techniques (JCGT), vol. 10, no. 2, 1-29, 2021&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>Morgan McGuire, Mike Mara, Derek Nowrouzezahrai, and David Luebke. 2017. <a href=https://doi.org/10.1145/3023368.3023378>Real-time global illumination using precomputed light field probes</a>. In Proceedings of the 21st ACM SIGGRAPH Symposium on Interactive 3D Graphics and Games (I3D '17). Association for Computing Machinery, New York, NY, USA, Article 2, 1-11.&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>Eric Heitz, <a href=https://jcgt.org/published/0007/04/01/>Sampling the GGX Distribution of Visible Normals</a>, Journal of Computer Graphics Techniques (JCGT), vol. 7, no. 4, 1-13, 2018&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p>Hanika, J. (2021). <a href=https://doi.org/10.1007/978-1-4842-7185-8_4>Hacking the Shadow Terminator</a>. In: Marrs, A., Shirley, P., Wald, I. (eds) Ray Tracing Gems II. Apress, Berkeley, CA.&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p>Zhdan, D. (2021). <a href=https://doi.org/10.1007/978-1-4842-7185-8_49>ReBLUR: A Hierarchical Recurrent Denoiser</a>. In: Marrs, A., Shirley, P., Wald, I. (eds) Ray Tracing Gems II. Apress, Berkeley, CA.&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post_comments><script type=module>

const light = 'lit';
const dark = 'dim';
const storageKey = 'colorMode';
const key = '--color-mode';
const data = 'data-mode';
const bank = window.localStorage;

function currentMode() {
  let acceptableChars = light + dark;
  acceptableChars = [...acceptableChars];
  let mode = getComputedStyle(doc).getPropertyValue(key).replace(/\"/g, '').trim();

  mode = [...mode].filter(function(letter){
    return acceptableChars.includes(letter);
  });

  return mode.join('');
}

function appendUtterances() {
  let initialTheme = currentMode() == dark ? 'github-dark' : 'github-light';
  const s = document.createElement('script');
  s.src = 'https://utteranc.es/client.js';
  s.setAttribute('repo', 'ChaoJia\/chaojia.github.io');
  s.setAttribute('issue-term', 'pathname');
  s.setAttribute('theme', initialTheme);
  s.setAttribute('crossorigin', 'anonymous');
  s.setAttribute('async', '');
  const commentsContainer = document.getElementsByClassName('post_comments')[0];
  commentsContainer.appendChild(s);
}

appendUtterances();

</script></div></article><aside class=sidebar><section class=sidebar_inner><br><div class=search><input type=search class="search_field form_field" placeholder=Search... id=find autocomplete=off data-scope=posts>
<label for=find class=search_label><svg class="icon"><title>search</title><use xlink:href="#search"/></svg></label><div class="search_results results"></div></div><h2>Chao Jia</h2><div class=author_bio>C++, Computer Graphics</div><a href=https://chaojia.github.io/about/ class="button mt-1" role=button title='Read More'>Read More</a><h2 class=mt-4>Recent Posts</h2><ul class=flex-column><li><a href=https://chaojia.github.io/posts/22-08-22-vulkan-basic-renderer/ class=nav-link title="A Basic Vulkan Renderer">A Basic Vulkan Renderer</a></li><li><a href=https://chaojia.github.io/posts/21-11-29-vertex-attrib-interp/ class=nav-link title="Vertex Attribute Interpolation and Analytical Derivatives">Vertex Attribute Interpolation and Analytical Derivatives</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>Categories</h2><nav class=tags_nav><a href=https://chaojia.github.io/categories/graphics/ class="post_tag button button_translucent" title=graphics>GRAPHICS
<span class=button_tally>2</span>
</a><a href=https://chaojia.github.io/categories/rendering/ class="post_tag button button_translucent" title=rendering>RENDERING
<span class=button_tally>2</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>Tags</h2><nav class=tags_nav><a href=https://chaojia.github.io/tags/real-time-rendering/ class="post_tag button button_translucent" title="real-time rendering">REAL-TIME RENDERING
<span class=button_tally>2</span>
</a><a href=https://chaojia.github.io/tags/c++/ class="post_tag button button_translucent" title=c++>C++
<span class=button_tally>1</span>
</a><a href=https://chaojia.github.io/tags/math/ class="post_tag button button_translucent" title=math>MATH
<span class=button_tally>1</span>
</a><a href=https://chaojia.github.io/tags/rtx/ class="post_tag button button_translucent" title=rtx>RTX
<span class=button_tally>1</span>
</a><a href=https://chaojia.github.io/tags/vulkan/ class="post_tag button button_translucent" title=vulkan>VULKAN
<span class=button_tally>1</span></a></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord"><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527.41542 45.5603.39851 45.468.440769 45.4204.525289 44.7963 1.6353 44.105 3.0834 43.6209 4.2216c-5.4572-.817-10.8864-.817-16.2317.0C26.905 3.0581 26.1886 1.6353 25.5617.525289 25.5141.443589 25.4218.40133 25.3294.41542c-5.071.87338-9.9237 2.40318-14.4518 4.48238C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795 1.57795 18.7309-.943561 32.1443.293408 45.3914.299005 45.4562.335386 45.5182.385761 45.5576 6.45866 50.0174 12.3413 52.7249 18.1147 54.5195 18.2071 54.5477 18.305 54.5139 18.3638 54.4378 19.7295 52.5728 20.9469 50.6063 21.9907 48.5383 22.0523 48.4172 21.9935 48.2735 21.8676 48.2256 19.9366 47.4931 18.0979 46.6 16.3292 45.5858 16.1893 45.5041 16.1781 45.304 16.3068 45.2082 16.679 44.9293 17.0513 44.6391 17.4067 44.3461 17.471 44.2926 17.5606 44.2813 17.6362 44.3151c11.6196 5.3051 24.1992 5.3051 35.6817.0C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433 53.9057 44.6363 54.2779 44.9293 54.6529 45.2082 54.7816 45.304 54.7732 45.5041 54.6333 45.5858c-1.7687 1.0339-3.6074 1.9073-5.5412 2.637C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383c1.0662 2.0651 2.2836 4.0316 3.6241 5.8967C52.6519 54.5139 52.7526 54.5477 52.845 54.5195c5.8014-1.7946 11.684-4.5021 17.7569-8.9619C70.6551 45.5182 70.6887 45.459 70.6943 45.3942 72.1747 30.0791 68.2147 16.7757 60.1968 4.9823 60.1772 4.9429 60.1437 4.9147 60.1045 4.8978zM23.7259 37.3253c-3.4983.0-6.3808-3.2117-6.3808-7.156s2.8266-7.156 6.3808-7.156c3.5821.0 6.4367 3.2399 6.3807 7.156.0 3.9443-2.8266 7.156-6.3807 7.156zm23.5919.0c-3.4982.0-6.3807-3.2117-6.3807-7.156s2.8265-7.156 6.3807-7.156c3.5822.0 6.4367 3.2399 6.3808 7.156.0 3.9443-2.7986 7.156-6.3808 7.156z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon"><path fill="#fff" d="m15.054695 9.8859583c-.22611 1.1632697-2.02517 2.4363497-4.09138 2.6830797-1.0774504.12856-2.1382704.24673-3.2694704.19484-1.84996-.0848-3.30971-.44157-3.30971-.44157.0.1801.0111.35157.0333.51194.24051 1.82571 1.81034 1.93508 3.29737 1.98607 1.50088.0514 2.8373104-.37004 2.8373104-.37004l.0617 1.35686s-1.0498104.56374-2.9199404.66742c-1.03124.0567-2.3117-.0259-3.80308-.42069-3.23454998-.85613-3.79081998-4.304-3.87592998-7.8024197-.026-1.03871-.01-2.01815-.01-2.83732.0-3.57732 2.34385998-4.62587996 2.34385998-4.62587996 1.18184-.54277 3.20976-.77101 5.318-.7882499985409h.0518C9.8267646.01719834 11.856025.24547834 13.037775.78824834c0 0 2.34377 1.04855996 2.34377 4.62587996.0.0.0294 2.63937-.32687 4.47183"/><path fill="#000" d="m12.616925 5.6916583v4.3315297h-1.71607V5.8189683c0-.88624-.37289-1.33607-1.1187604-1.33607-.82467.0-1.23799.53361-1.23799 1.58875v2.30122h-1.70594v-2.30122c0-1.05514-.4134-1.58875-1.23808-1.58875-.74587.0-1.11876.44983-1.11876 1.33607v4.2042197h-1.71607V5.6916583c0-.88527.22541-1.58876.67817-2.10922.46689-.52047 1.07833-.78727 1.83735-.78727.87816.0 1.54317.33752 1.98288 1.01267l.42744.71655.42753-.71655c.43961-.67515 1.10463-1.01267 1.9828704-1.01267.75893.0 1.37037.2668 1.83735.78727.45268.52046.67808 1.22395.67808 2.10922"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" id="bluesky"><path d="m135.72 44.03C202.216 93.951 273.74 195.17 3e2 249.49c26.262-54.316 97.782-155.54 164.28-205.46C512.26 8.009 590-19.862 590 68.825c0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-.0174-2.9357-1.1937.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07.0-88.687 77.742-60.816 125.72-24.795z"/><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="ko-fi"><path fill="#fff" d="M4.5 9.8527H32.7947a0 0 0 010 0v19.225a9.07 9.07.0 01-9.07 9.07H13.57a9.07 9.07.0 01-9.07-9.07V9.8527a0 0 0 010 0z"/><path fill="#000" d="M12.197 25.9493l6.45 6.45 6.45-6.45a8.2 8.2.0 002.4016-5.798h0a4.5082 4.5082.0 00-4.212-4.5459 4.4262 4.4262.0 00-4.64 4.4209 4.4261 4.4261.0 00-4.64-4.4209 4.5082 4.5082.0 00-4.212 4.5459h0a8.2 8.2.0 002.4024 5.798z"/><path fill="#fff" d="M32.7947 9.8527H35.73a7.77 7.77.0 010 15.5394H32.7947"/></svg></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://chaojia.github.io/images/logo.svg class="icon icon_2 transparent" alt="Chao Jia"><p>Copyright&nbsp;<span class=year></span>&nbsp;CHAO JIA. All Rights Reserved</p></div></footer><script type=text/javascript src=https://chaojia.github.io/en/js/bundle.530b93f8d0aee3448bb6eb26a4511f74ffd5c79691ceb46e604efd83030618d58068f616ae32d64309c8c7fb8de76c58f297b69ba0795ff63e9ab0fa866816a0.js integrity="sha512-UwuT+NCu40SLtusmpFEfdP/Vx5aRzrRuYE79gwMGGNWAaPYWrjLWQwnIx/uN52xY8pe2m6B5X/Y+mrD6hmgWoA==" crossorigin=anonymous></script><script src=https://chaojia.github.io/js/search.min.294fcf37257b9f88fd2af6a83fc9b85d6a579eaf4f0064e433de9b26834562f2a9624d8916a6e2198bbad6735318ffa07a4d45d3914a437341dc64e5eae103a6.js></script></body></html>